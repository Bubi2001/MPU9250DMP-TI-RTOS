
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A comprehensive C/C++ driver for the MPU-6500 and MPU-9250 on the TI-RTOS platform.">
      
      
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../cpp_class/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Base C Library - MPU-6500/9250 TI-RTOS Driver</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mpu9250-9-dof-imu-driver-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MPU-6500/9250 TI-RTOS Driver" class="md-header__button md-logo" aria-label="MPU-6500/9250 TI-RTOS Driver" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MPU-6500/9250 TI-RTOS Driver
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Base C Library
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MPU-6500/9250 TI-RTOS Driver" class="md-nav__button md-logo" aria-label="MPU-6500/9250 TI-RTOS Driver" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MPU-6500/9250 TI-RTOS Driver
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Base C Library
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Base C Library
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#public-enums-and-structures" class="md-nav__link">
    <span class="md-ellipsis">
      Public Enums and Structures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Public Enums and Structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#status-codes-mpu9250_status_e" class="md-nav__link">
    <span class="md-ellipsis">
      Status Codes (MPU9250_Status_e)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sensor-configuration-enums" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor Configuration Enums
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sensor-fusion-enums" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor Fusion Enums
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-data-structures" class="md-nav__link">
    <span class="md-ellipsis">
      Core Data Structures
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensor-fusion-algorithms-explained" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor Fusion Algorithms Explained
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sensor Fusion Algorithms Explained">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#complementary-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Complementary Filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#madgwick-ahrs-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Madgwick AHRS Filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mahony-ahrs-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Mahony AHRS Filter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-function-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Function Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Function Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lifecycle-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Lifecycle &amp; Initialization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-acquisition" class="md-nav__link">
    <span class="md-ellipsis">
      Data Acquisition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calibration-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Calibration &amp; Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Calibration &amp; Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reference-frames-explained" class="md-nav__link">
    <span class="md-ellipsis">
      Reference Frames Explained
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sensor-fusion" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor Fusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      Data Retrieval
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage-ti-rtos" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage (TI-RTOS)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpp_class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++ DMP Class
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#public-enums-and-structures" class="md-nav__link">
    <span class="md-ellipsis">
      Public Enums and Structures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Public Enums and Structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#status-codes-mpu9250_status_e" class="md-nav__link">
    <span class="md-ellipsis">
      Status Codes (MPU9250_Status_e)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sensor-configuration-enums" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor Configuration Enums
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sensor-fusion-enums" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor Fusion Enums
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-data-structures" class="md-nav__link">
    <span class="md-ellipsis">
      Core Data Structures
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensor-fusion-algorithms-explained" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor Fusion Algorithms Explained
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sensor Fusion Algorithms Explained">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#complementary-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Complementary Filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#madgwick-ahrs-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Madgwick AHRS Filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mahony-ahrs-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Mahony AHRS Filter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-function-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Function Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Function Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lifecycle-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Lifecycle &amp; Initialization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-acquisition" class="md-nav__link">
    <span class="md-ellipsis">
      Data Acquisition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calibration-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Calibration &amp; Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Calibration &amp; Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reference-frames-explained" class="md-nav__link">
    <span class="md-ellipsis">
      Reference Frames Explained
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sensor-fusion" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor Fusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      Data Retrieval
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage-ti-rtos" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage (TI-RTOS)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="mpu9250-9-dof-imu-driver-api-reference">MPU9250 9-DOF IMU Driver API Reference</h1>
<p>This document provides a detailed API reference for the <code>mpu9250_driver</code>, which interfaces with the TDK InvenSense MPU-9250 9-DOF inertial measurement unit (IMU). The driver is specifically designed for the <strong>Texas Instruments MSP-EXP432E401Y LaunchPad</strong> running the <strong>TI-RTOS</strong> real-time operating system.</p>
<p>The driver is written in C and uses a handle-based interface (<code>MPU9250_Handle</code>), which encapsulates the entire state of the sensor instance. It's built to be robust, configurable, and provide a high-level interface for complex tasks like calibration and sensor fusion.</p>
<h2 id="key-features">Key Features</h2>
<ul>
<li><strong>Robust Initialization:</strong> Automatically detects MPU9250, MPU9255, and MPU6500 variants.</li>
<li><strong>Full Configuration:</strong> Provides easy-to-use structures for configuring sensor ranges, digital low-pass filters (DLPF), and sample rates.</li>
<li><strong>Automated Calibration:</strong> Includes functions to calculate biases and variances for the accelerometer, gyroscope, and magnetometer, which are essential for high-quality sensor fusion.</li>
<li><strong>Interactive Orientation Setup:</strong> A guided routine helps determine the physical orientation matrix of the sensor, removing the need for hard-coded coordinate transformations.</li>
<li><strong>Unified Sensor Fusion Module:</strong> Integrates Complementary, Madgwick, and Mahony filters for stable 6-DoF (Accel + Gyro) and 9-DoF (Accel + Gyro + Mag) orientation tracking.</li>
<li><strong>Comprehensive Error Handling:</strong> Returns detailed status codes for easier debugging.</li>
</ul>
<hr />
<h2 id="public-enums-and-structures">Public Enums and Structures</h2>
<p>These are the primary data types used to configure and interact with the driver. Understanding them is key to using the library effectively.</p>
<h3 id="status-codes-mpu9250_status_e">Status Codes (<code>MPU9250_Status_e</code>)</h3>
<p>This enum lists all possible return codes for functions that can fail, helping you diagnose issues in your application.</p>
<ul>
<li><code>MPU9250_OK</code>: Operation was successful.</li>
<li><code>MPU9250_ERROR_INVALID_HANDLE</code>: The provided sensor handle was <code>NULL</code>.</li>
<li><code>MPU9250_ERROR_MALLOC</code>: Failed to allocate memory for the handle.</li>
<li><code>MPU9250_ERROR_I2C</code>: An I2C communication error occurred.</li>
<li><code>MPU9250_ERROR_WHO_AM_I</code>: The device <code>WHO_AM_I</code> value was incorrect, meaning the wrong chip is connected or it's not responding.</li>
<li><code>MPU9250_ERROR_TIMEOUT</code>: A timeout occurred waiting for a sensor event.</li>
<li><code>MPU9250_ERROR_INVALID_PARAM</code>: An invalid parameter was passed to a function (e.g., <code>dt</code> was zero).</li>
<li><code>MPU9250_ERROR_NOT_SUPPORTED</code>: The requested feature is not supported by the detected device.</li>
</ul>
<h3 id="sensor-configuration-enums">Sensor Configuration Enums</h3>
<p>These enums allow you to configure the physical behavior of the sensor.</p>
<ul>
<li><code>AccelFSR_e</code> (Accelerometer Full-Scale Range):</li>
<li><code>ACCEL_FS_2G</code>: +/- 2g</li>
<li><code>ACCEL_FS_4G</code>: +/- 4g</li>
<li><code>ACCEL_FS_8G</code>: +/- 8g</li>
<li><code>ACCEL_FS_16G</code>: +/- 16g</li>
<li><code>GyroFSR_e</code> (Gyroscope Full-Scale Range):</li>
<li><code>GYRO_FS_250DPS</code>: +/- 250 degrees per second</li>
<li><code>GYRO_FS_500DPS</code>: +/- 500 degrees per second</li>
<li><code>GYRO_FS_1000DPS</code>: +/- 1000 degrees per second</li>
<li><code>GYRO_FS_2000DPS</code>: +/- 2000 degrees per second</li>
<li><code>AccelDLPF_e</code> (Accelerometer Digital Low-Pass Filter):</li>
<li><code>ACCEL_DLPF_218HZ</code></li>
<li><code>ACCEL_DLPF_99HZ</code></li>
<li><code>ACCEL_DLPF_41HZ</code></li>
<li><code>ACCEL_DLPF_20HZ</code></li>
<li><code>ACCEL_DLPF_10HZ</code></li>
<li><code>ACCEL_DLPF_5HZ</code></li>
<li><code>GyroDLPF_e</code> (Gyroscope Digital Low-Pass Filter):</li>
<li><code>GYRO_DLPF_184HZ</code></li>
<li><code>GYRO_DLPF_92HZ</code></li>
<li><code>GYRO_DLPF_41HZ</code></li>
<li><code>GYRO_DLPF_20HZ</code></li>
<li><code>GYRO_DLPF_10HZ</code></li>
<li><code>GYRO_DLPF_5HZ</code></li>
<li><code>MagMode_e</code> (Magnetometer Mode):</li>
<li><code>MAG_MODE_8HZ</code>: 8 Hz continuous measurement.</li>
<li><code>MAG_MODE_100HZ</code>: 100 Hz continuous measurement.</li>
<li><code>MagOutput_e</code> (Magnetometer Resolution):</li>
<li><code>MAG_OUT_14_BIT</code>: 14-bit output resolution.</li>
<li><code>MAG_OUT_16_BIT</code>: 16-bit output resolution.</li>
</ul>
<h3 id="sensor-fusion-enums">Sensor Fusion Enums</h3>
<p>These enums are used to control the sensor fusion module.</p>
<ul>
<li><code>FusionAlgorithm_e</code>:</li>
<li><code>FUSION_ALGORITHM_COMPLEMENTARY</code>: Simple Complementary Filter.</li>
<li><code>FUSION_ALGORITHM_MADGWICK</code>: Madgwick Gradient Descent AHRS.</li>
<li><code>FUSION_ALGORITHM_MAHONY</code>: Mahony PI Controller AHRS.</li>
<li><code>FusionDOF_e</code> (Degrees of Freedom):</li>
<li><code>FUSION_DOF_6</code>: Use Accelerometer and Gyroscope only.</li>
<li><code>FUSION_DOF_9</code>: Use Accelerometer, Gyroscope, and Magnetometer.</li>
</ul>
<h3 id="core-data-structures">Core Data Structures</h3>
<ul>
<li><code>MPU9250_Config</code>: This structure holds all the initial settings for the sensor. You populate it and pass it to <code>MPU9250_init</code>.</li>
<li><code>uint8_t i2cAddress</code>: The I2C address of the sensor (0x68 or 0x69).</li>
<li><code>AccelFSR_e accelFSR</code>: Accelerometer full-scale range.</li>
<li><code>GyroFSR_e gyroFSR</code>: Gyroscope full-scale range.</li>
<li><code>uint8_t sampleRateDivider</code>: Divides the internal 1kHz sample rate. <code>Sample Rate = 1kHz / (1 + divider)</code>.</li>
<li><code>AccelDLPF_e accelDLPF</code>: Accelerometer Digital Low-Pass Filter setting.</li>
<li><code>GyroDLPF_e gyroDLPF</code>: Gyroscope Digital Low-Pass Filter setting.</li>
<li><code>MagMode_e magMode</code>: Magnetometer continuous measurement mode.</li>
<li><code>MagOutput_e magOutput</code>: Magnetometer output bit resolution.</li>
<li><code>MPU9250_Handle</code>: This is the main object for your sensor instance. It's created by <code>MPU9250_init</code> and holds the complete state of the driver and sensor.</li>
<li><strong>TI-RTOS Communication Handles</strong><ul>
<li><code>I2C_Handle i2cHandle</code>: Handle to the I2C peripheral from TI-RTOS.</li>
<li><code>I2C_Transaction *i2cTransaction</code>: Pointer to a user-provided I2C transaction struct.</li>
<li><code>uint8_t i2cAddress</code>: The I2C address of the sensor.</li>
</ul>
</li>
<li><strong>Sensor State &amp; Data</strong><ul>
<li><code>bool hasMag</code>: <code>true</code> if an AK8963 magnetometer is detected.</li>
<li><code>MPU9250_Vector3D accelerometer</code>: Latest accelerometer reading in m/s².</li>
<li><code>MPU9250_Vector3D gyroscope</code>: Latest gyroscope reading in rad/s.</li>
<li><code>MPU9250_Vector3D magnetometer</code>: Latest magnetometer reading in µT.</li>
<li><code>float temperature</code>: Latest temperature reading in Celsius.</li>
<li><code>float sampleRate</code>: The configured sample rate in Hz.</li>
</ul>
</li>
<li><strong>Calibration Data</strong><ul>
<li><code>MPU9250_Vector3D accelBias</code>, <code>gyroBias</code>, <code>magBias</code>: Biases (offsets) calculated by <code>MPU9250_calibrate</code> and automatically subtracted from raw readings.</li>
<li><code>MPU9250_Vector3D accelVariance</code>, <code>gyroVariance</code>, <code>magVariance</code>: Measurement variances, useful for advanced filters like an EKF.</li>
</ul>
</li>
<li><strong>Internal Scale Factors</strong><ul>
<li><code>float accelScale</code>, <code>gyroScale</code>, <code>magScale</code>: Conversion factors from raw sensor values to physical units.</li>
<li><code>MPU9250_Vector3D magAdjust</code>: Magnetometer sensitivity adjustments read from the sensor's internal ROM.</li>
</ul>
</li>
<li><strong>Sensor Fusion State</strong><ul>
<li><code>MPU9250_FusionState fusion</code>: A nested struct holding the state and results of the chosen fusion algorithm.</li>
</ul>
</li>
</ul>
<hr />
<h2 id="sensor-fusion-algorithms-explained">Sensor Fusion Algorithms Explained</h2>
<p>A raw IMU gives you noisy, drifting data. Sensor fusion algorithms combine the data from multiple sensors to produce a stable and accurate estimate of the device's orientation. This driver includes three popular algorithms.</p>
<h3 id="complementary-filter">Complementary Filter</h3>
<p>This is the simplest and most intuitive of the filters. It works in the frequency domain.</p>
<ul>
<li><strong>Concept</strong>: It combines the gyroscope and accelerometer data by trusting each one in the domain where it performs best.</li>
<li><strong>Gyroscopes</strong> are good at tracking <em>fast</em> changes in orientation (high-frequency), but they drift over time.</li>
<li><strong>Accelerometers</strong> can determine the direction of gravity (and thus roll/pitch) when the device is still or moving slowly, making them a stable reference for <em>slow</em> changes (low-frequency).</li>
<li><strong>How it Works</strong>: The filter is essentially a weighted average. The new angle is calculated as:
  <code>angle = α * (previous_angle + gyro_rate * dt) + (1 - α) * accel_angle</code></li>
<li>The <code>α</code> (alpha) parameter is a filter coefficient (e.g., 0.98). A higher value means you trust the gyroscope more, making the filter responsive but more prone to drift. A lower value trusts the accelerometer more, making it stable but sluggish.</li>
<li><strong>Pros</strong>: Computationally very cheap and easy to understand.</li>
<li><strong>Cons</strong>: Less accurate than other methods, especially during complex movements. Yaw (heading) can only be determined with a magnetometer and is also subject to drift if only using the gyro.</li>
</ul>
<h3 id="madgwick-ahrs-filter">Madgwick AHRS Filter</h3>
<p>This is a much more sophisticated algorithm based on quaternions and gradient descent optimization.</p>
<ul>
<li><strong>Concept</strong>: It uses the gyroscope to predict the orientation and then uses the accelerometer and magnetometer as a reference to correct for drift.</li>
<li>
<p><strong>How it Works</strong>:</p>
</li>
<li>
<p>The gyroscope data is integrated to predict the new orientation quaternion.</p>
</li>
<li>An "objective function" is created using the accelerometer and magnetometer data. This function represents the error between the orientation predicted by the gyro and the orientation measured by the reference sensors.</li>
<li>A mathematical technique called <strong>gradient descent</strong> is used to find the direction in which the orientation quaternion needs to be adjusted to minimize this error.</li>
<li>
<p>The quaternion is adjusted in that direction by a small amount, controlled by the gain parameter <code>β</code> (beta). <code>β</code> represents the gyroscope measurement error; a higher value corrects the orientation more aggressively.</p>
</li>
<li>
<p><strong>Pros</strong>: Very accurate and robust across a wide range of motions. It's considered one of the gold standards for IMU orientation filtering.</p>
</li>
<li><strong>Cons</strong>: More computationally expensive than the Complementary or Mahony filters.</li>
</ul>
<h3 id="mahony-ahrs-filter">Mahony AHRS Filter</h3>
<p>The Mahony filter is another advanced quaternion-based filter that is computationally more efficient than the Madgwick filter.</p>
<ul>
<li><strong>Concept</strong>: It works like a <strong>Proportional-Integral (PI) controller</strong>, a common concept in control theory. The "error" is the difference between the direction of gravity measured by the accelerometer and the direction of gravity estimated by the current orientation.</li>
<li>
<p><strong>How it Works</strong>:</p>
</li>
<li>
<p>The error between the measured and estimated reference vectors (gravity and magnetic north) is calculated.</p>
</li>
<li>This error is fed into a PI controller.</li>
<li>The <strong>Proportional gain (<code>Kp</code>)</strong> makes an immediate correction to the orientation based on the current error. It's like pushing the estimate back towards the correct orientation.</li>
<li>The <strong>Integral gain (<code>Ki</code>)</strong> accumulates the error over time. This term is used to estimate and cancel out the gyroscope's bias drift, which is the primary source of long-term error.</li>
<li>
<p>The output of the PI controller is used to correct the angular velocity from the gyroscope before it's integrated.</p>
</li>
<li>
<p><strong>Pros</strong>: Almost as accurate as the Madgwick filter but significantly less computationally intensive, making it ideal for microcontrollers with limited processing power.</p>
</li>
<li><strong>Cons</strong>: Can be slightly less responsive than the Madgwick filter under very high-speed, complex motion.</li>
</ul>
<hr />
<h2 id="api-function-reference">API Function Reference</h2>
<p>All functions are exposed in <code>mpu9250_driver.h</code>.</p>
<h3 id="lifecycle-initialization">Lifecycle &amp; Initialization</h3>
<p><code>void MPU9250_getDefaultConfig(MPU9250_Config *config)</code></p>
<ul>
<li><strong>Description</strong>: Fills a configuration structure with default, recommended settings for general-purpose use.</li>
<li><strong>Parameters</strong>:</li>
<li><code>[out] config</code>: A pointer to the configuration structure to be populated.</li>
</ul>
<p><code>MPU9250_Status_e MPU9250_init(MPU9250_Handle **sensor_p, I2C_Handle i2c, I2C_Transaction *transaction, const MPU9250_Config *config)</code></p>
<ul>
<li><strong>Description</strong>: Initializes the MPU9250 sensor. This is the first function that must be called. It allocates memory for the sensor handle, resets the device, verifies its identity (<code>WHO_AM_I</code>), and applies the settings from the configuration structure.</li>
<li><strong>Parameters</strong>:</li>
<li><code>[out] sensor_p</code>: A pointer to the handle pointer (<code>MPU9250_Handle*</code>). The driver will allocate memory and store the address of the new handle here.</li>
<li><code>[in] i2c</code>: A handle to an initialized TI-RTOS I2C peripheral.</li>
<li><code>[in] transaction</code>: A pointer to a user-provided <code>I2C_Transaction</code> structure. The driver will use this for all I2C communication.</li>
<li><code>[in] config</code>: A pointer to a configuration structure with the desired settings.</li>
<li><strong>Returns</strong>: <code>MPU9250_OK</code> on success, or an error code on failure.</li>
</ul>
<p><code>void MPU9250_deinit(MPU9250_Handle *sensor)</code></p>
<ul>
<li><strong>Description</strong>: Deinitializes the sensor and frees the memory allocated for the handle.</li>
<li><strong>Parameters</strong>:</li>
<li><code>[in] sensor</code>: The handle to deinitialize.</li>
</ul>
<h3 id="data-acquisition">Data Acquisition</h3>
<p><code>MPU9250_Status_e MPU9250_readSensors(MPU9250_Handle *sensor)</code></p>
<ul>
<li><strong>Description</strong>: Performs a burst-read to fetch the latest data from the accelerometer, gyroscope, temperature sensor, and (if present) the magnetometer. It applies calibration biases and scaling factors to convert the raw data into standard physical units (m/s², rad/s, µT, °C). The results are stored within the <code>sensor</code> handle (e.g., <code>sensor-&gt;accelerometer</code>, <code>sensor-&gt;gyroscope</code>).</li>
<li><strong>Parameters</strong>:</li>
<li><code>[in,out] sensor</code>: Pointer to the initialized sensor handle.</li>
<li><strong>Returns</strong>: <code>MPU9250_OK</code> on success, or an error code on failure.</li>
</ul>
<h3 id="calibration-setup">Calibration &amp; Setup</h3>
<p><code>MPU9250_Status_e MPU9250_calibrate(MPU9250_Handle *sensor, uint16_t numSamples)</code></p>
<ul>
<li><strong>Description</strong>: Performs a static calibration. It averages a number of samples to calculate the bias (offset) and variance for each sensor axis. These values are stored in the handle and automatically subtracted from future readings.</li>
<li><strong>Precondition</strong>: The device must be kept perfectly still and level during the calibration process.</li>
<li><strong>Parameters</strong>:</li>
<li><code>[in,out] sensor</code>: Pointer to the initialized sensor handle.</li>
<li><code>[in] numSamples</code>: The number of samples to collect and average (e.g., 1000). More samples yield better results but take longer.</li>
<li><strong>Returns</strong>: <code>MPU9250_OK</code> on success, or an error code on failure.</li>
</ul>
<p><code>MPU9250_Status_e MPU9250_determineOrientationAxes(MPU9250_Handle *sensor, MPU9250_Matrix3x3 *matrix, ReferenceFrame_e frame)</code></p>
<ul>
<li><strong>Description</strong>: Runs an interactive, two-step console routine to determine the sensor's physical orientation relative to a <strong>user-selected reference frame</strong> (<code>NED</code> or <code>ENU</code>). It populates a rotation matrix that can be used with <code>MPU9250_applyRotation</code> to transform sensor readings from the body frame to the selected world frame. The interactive process guides the user to first establish the vertical axis by measuring gravity and then find the forward (North) axis by performing a specific motion.</li>
<li><strong>Parameters</strong>:</li>
<li><code>[in] sensor</code>: Pointer to the initialized and calibrated sensor handle.</li>
<li><code>[out] matrix</code>: A pointer to a 3x3 matrix where the resulting orientation matrix will be stored.</li>
<li><code>[in] frame</code>: The desired reference frame for calibration. This must be one of the values from the <code>ReferenceFrame_e</code> enum (<code>FRAME_NED</code> or <code>FRAME_ENU</code>).</li>
<li><strong>Returns</strong>: <code>MPU9250_OK</code> on success, or an error code on failure.</li>
</ul>
<hr />
<h4 id="reference-frames-explained"><strong>Reference Frames Explained</strong></h4>
<p>The <code>frame</code> parameter allows you to align the sensor's data with one of two common coordinate systems used in navigation and robotics.</p>
<ul>
<li><strong>NED (North-East-Down)</strong></li>
</ul>
<p>This is a local tangent plane frame commonly used in <strong>aerospace and aviation</strong> applications.</p>
<ul>
<li><strong>X-axis:</strong> Points to true <strong>North</strong>.</li>
<li><strong>Y-axis:</strong> Points to true <strong>East</strong>.</li>
<li><strong>Z-axis:</strong> Points <strong>Down</strong>, towards the center of the Earth.</li>
<li><strong>ENU (East-North-Up)</strong></li>
</ul>
<p>This frame is widely used in <strong>geodetic, surveying, and ground-based robotics</strong> applications.</p>
<ul>
<li><strong>X-axis:</strong> Points to true <strong>East</strong>.</li>
<li><strong>Y-axis:</strong> Points to true <strong>North</strong>.</li>
<li><strong>Z-axis:</strong> Points <strong>Up</strong>, away from the center of the Earth.</li>
</ul>
<hr />
<p><code>void MPU9250_applyRotation(const MPU9250_Matrix3x3 *matrix, MPU9250_Vector3D *vector)</code></p>
<ul>
<li><strong>Description</strong>: A utility function to apply a coordinate transformation to a 3D vector using a rotation matrix (<code>V_rotated = R * V_original</code>). This is useful for rotating sensor data from the body frame to the world frame before sensor fusion.</li>
<li><strong>Parameters</strong>:</li>
<li><code>[in] matrix</code>: Pointer to the 3x3 rotation matrix.</li>
<li><code>[in,out] vector</code>: Pointer to the vector to be rotated. The operation is done in-place.</li>
</ul>
<h3 id="sensor-fusion">Sensor Fusion</h3>
<p><code>MPU9250_Status_e MPU9250_SensorFusionInit(MPU9250_Handle *sensor, FusionAlgorithm_e algorithm, const void *params)</code></p>
<ul>
<li><strong>Description</strong>: Initializes the sensor fusion module. This sets the desired algorithm and its associated parameters (e.g., filter gain).</li>
<li><strong>Parameters</strong>:</li>
<li><code>[in,out] sensor</code>: Pointer to the sensor handle.</li>
<li><code>[in] algorithm</code>: The fusion algorithm to use (e.g., <code>FUSION_ALGORITHM_MADGWICK</code>).</li>
<li><code>[in] params</code>: A void pointer to a parameter structure corresponding to the chosen algorithm (e.g., a <code>MadgwickFilterParams</code> struct).</li>
<li><strong>Returns</strong>: <code>MPU9250_OK</code> on success, or an error code.</li>
</ul>
<p><code>MPU9250_Status_e MPU9250_SensorFusionUpdate(MPU9250_Handle *sensor, FusionDOF_e dof, float dt)</code></p>
<ul>
<li><strong>Description</strong>: Runs one iteration of the configured fusion algorithm. It uses the latest sensor data stored in the handle to update the orientation estimate. The result is stored internally in <code>sensor-&gt;fusion.orientation</code>.</li>
<li>
<p><strong>Preconditions</strong>:</p>
</li>
<li>
<p><code>MPU9250_readSensors()</code> should be called immediately before this function to get fresh data.</p>
</li>
<li>
<p>For best results, sensor data should be transformed to the world frame via <code>MPU9250_applyRotation()</code> before calling this function.</p>
</li>
<li>
<p><strong>Parameters</strong>:</p>
</li>
<li><code>[in,out] sensor</code>: Pointer to the sensor handle.</li>
<li><code>[in] dof</code>: The degrees of freedom to use for the update (<code>FUSION_DOF_6</code> for Accel+Gyro, <code>FUSION_DOF_9</code> for Accel+Gyro+Mag).</li>
<li><code>[in] dt</code>: The time elapsed since the last update, in seconds. This is critical for accurate integration.</li>
<li><strong>Returns</strong>: <code>MPU9250_OK</code> on success, or an error code.</li>
</ul>
<h3 id="data-retrieval">Data Retrieval</h3>
<p><code>MPU9250_Status_e MPU9250_getOrientation(MPU9250_Handle *sensor, MPU9250_Quaternion *q)</code></p>
<ul>
<li><strong>Description</strong>: Gets the current orientation calculated by the fusion filter as a quaternion.</li>
<li><strong>Parameters</strong>:</li>
<li><code>[in] sensor</code>: Pointer to the sensor handle.</li>
<li><code>[out] q</code>: Pointer to a quaternion structure where the result will be stored.</li>
<li><strong>Returns</strong>: <code>MPU9250_OK</code> on success, or an error code.</li>
</ul>
<p><code>MPU9250_Status_e MPU9250_getEulerAngles(MPU9250_Handle *sensor, MPU9250_EulerAngles *angles)</code></p>
<ul>
<li><strong>Description</strong>: Gets the current orientation as Euler angles (roll, pitch, yaw). It converts the internal orientation quaternion to Euler angles in  <strong>radians</strong>.</li>
<li><strong>Parameters</strong>:</li>
<li><code>[in] sensor</code>: Pointer to the sensor handle.</li>
<li><code>[out] angles</code>: Pointer to an <code>MPU9250_EulerAngles</code> structure where the result will be stored.</li>
<li><strong>Returns</strong>: <code>MPU9250_OK</code> on success, or an error code.</li>
</ul>
<hr />
<h2 id="example-usage-ti-rtos">Example Usage (TI-RTOS)</h2>
<p>This example demonstrates the typical usage pattern for the MPU9250 driver within a TI-RTOS task.</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdint.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;xdc/runtime/System.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ti/sysbios/knl/Task.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ti/sysbios/knl/Clock.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ti/drivers/I2C.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ti_drivers_config.h&quot;</span><span class="c1"> // Generated by SysConfig</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;MPU9250.h&quot;</span>

<span class="cp">#define SENSOR_UPDATE_PERIOD_MS 10 </span><span class="c1">// For a 100 Hz update rate</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">sensorTaskFxn</span><span class="p">(</span><span class="n">UArg</span><span class="w"> </span><span class="n">arg0</span><span class="p">,</span><span class="w"> </span><span class="n">UArg</span><span class="w"> </span><span class="n">arg1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">I2C_Handle</span><span class="w"> </span><span class="n">i2cHandle</span><span class="p">;</span>
<span class="w">    </span><span class="n">I2C_Params</span><span class="w"> </span><span class="n">i2cParams</span><span class="p">;</span>
<span class="w">    </span><span class="n">I2C_Transaction</span><span class="w"> </span><span class="n">i2cTransaction</span><span class="p">;</span>

<span class="w">    </span><span class="n">MPU9250_Handle</span><span class="w"> </span><span class="o">*</span><span class="n">sensor_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">MPU9250_Config</span><span class="w"> </span><span class="n">sensor_config</span><span class="p">;</span>
<span class="w">    </span><span class="n">MPU9250_EulerAngles</span><span class="w"> </span><span class="n">euler_angles</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* 1. Initialize I2C Driver */</span>
<span class="w">    </span><span class="n">I2C_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2cParams</span><span class="p">);</span>
<span class="w">    </span><span class="n">i2cParams</span><span class="p">.</span><span class="n">bitRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_400kHz</span><span class="p">;</span>
<span class="w">    </span><span class="n">i2cHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_open</span><span class="p">(</span><span class="n">CONFIG_I2C_0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i2cParams</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i2cHandle</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System_printf</span><span class="p">(</span><span class="s">&quot;Error Initializing I2C</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">System_flush</span><span class="p">();</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Configure the transaction struct. This will be used by the driver.</span>
<span class="w">    </span><span class="n">i2cTransaction</span><span class="p">.</span><span class="n">readBuf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">i2cTransaction</span><span class="p">.</span><span class="n">readCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">i2cTransaction</span><span class="p">.</span><span class="n">writeBuf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">i2cTransaction</span><span class="p">.</span><span class="n">writeCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* 2. Initialize the MPU9250 Driver */</span>
<span class="w">    </span><span class="n">MPU9250_getDefaultConfig</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sensor_config</span><span class="p">);</span><span class="w"> </span><span class="c1">// Start with defaults</span>
<span class="w">    </span><span class="n">sensor_config</span><span class="p">.</span><span class="n">accelFSR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ACCEL_FS_4G</span><span class="p">;</span>
<span class="w">    </span><span class="n">sensor_config</span><span class="p">.</span><span class="n">gyroFSR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GYRO_FS_500DPS</span><span class="p">;</span>
<span class="w">    </span><span class="n">sensor_config</span><span class="p">.</span><span class="n">sampleRateDivider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span><span class="w"> </span><span class="c1">// Sets sample rate to 1kHz / (1+9) = 100Hz</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MPU9250_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sensor_handle</span><span class="p">,</span><span class="w"> </span><span class="n">i2cHandle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i2cTransaction</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sensor_config</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">MPU9250_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System_printf</span><span class="p">(</span><span class="s">&quot;Failed to initialize MPU9250 sensor.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">System_flush</span><span class="p">();</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">System_printf</span><span class="p">(</span><span class="s">&quot;MPU9250 Initialized.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">System_flush</span><span class="p">();</span>

<span class="w">    </span><span class="cm">/* 3. Calibrate the sensor */</span>
<span class="w">    </span><span class="n">System_printf</span><span class="p">(</span><span class="s">&quot;Calibrating... Keep the sensor still.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">System_flush</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MPU9250_calibrate</span><span class="p">(</span><span class="n">sensor_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">MPU9250_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System_printf</span><span class="p">(</span><span class="s">&quot;Calibration failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">System_flush</span><span class="p">();</span>
<span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">System_printf</span><span class="p">(</span><span class="s">&quot;Calibration complete.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">System_flush</span><span class="p">();</span>

<span class="w">    </span><span class="cm">/* 4. Initialize the Sensor Fusion Module (using Madgwick) */</span>
<span class="w">    </span><span class="n">MadgwickFilterParams</span><span class="w"> </span><span class="n">fusion_params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{.</span><span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MPU9250_SensorFusionInit</span><span class="p">(</span><span class="n">sensor_handle</span><span class="p">,</span><span class="w"> </span><span class="n">FUSION_ALGORITHM_MADGWICK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fusion_params</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">MPU9250_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System_printf</span><span class="p">(</span><span class="s">&quot;Failed to init sensor fusion.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">System_flush</span><span class="p">();</span>
<span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">System_printf</span><span class="p">(</span><span class="s">&quot;Sensor Fusion Initialized. Reading data...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">System_flush</span><span class="p">();</span>

<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">SENSOR_UPDATE_PERIOD_MS</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000.0f</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* 5. Main loop to read and process data */</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Delay to maintain a consistent update rate</span>
<span class="w">        </span><span class="n">Task_sleep</span><span class="p">(</span><span class="n">SENSOR_UPDATE_PERIOD_MS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Clock_tickPeriod</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Read the latest sensor data</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MPU9250_readSensors</span><span class="p">(</span><span class="n">sensor_handle</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MPU9250_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="c1">// Update the fusion algorithm with the new data</span>
<span class="w">            </span><span class="n">MPU9250_SensorFusionUpdate</span><span class="p">(</span><span class="n">sensor_handle</span><span class="p">,</span><span class="w"> </span><span class="n">FUSION_DOF_9</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Get the resulting orientation in Euler angles</span>
<span class="w">            </span><span class="n">MPU9250_getEulerAngles</span><span class="p">(</span><span class="n">sensor_handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">euler_angles</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Convert radians to degrees for printing</span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">roll_deg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">euler_angles</span><span class="p">.</span><span class="n">roll</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">180.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">M_PI</span><span class="p">;</span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">pitch_deg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">euler_angles</span><span class="p">.</span><span class="n">pitch</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">180.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">M_PI</span><span class="p">;</span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">yaw_deg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">euler_angles</span><span class="p">.</span><span class="n">yaw</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">180.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">M_PI</span><span class="p">;</span>

<span class="w">            </span><span class="n">System_printf</span><span class="p">(</span><span class="s">&quot;Roll: %.2f, Pitch: %.2f, Yaw: %.2f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">roll_deg</span><span class="p">,</span><span class="w"> </span><span class="n">pitch_deg</span><span class="p">,</span><span class="w"> </span><span class="n">yaw_deg</span><span class="p">);</span>
<span class="w">            </span><span class="n">System_flush</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 16, 2025 09:53:16 UTC">October 16, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.top", "navigation.sections", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>